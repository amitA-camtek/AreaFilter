<Window x:Class="AreaFilter.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:AreaFilter"
        xmlns:controls="clr-namespace:AreaFilter.Controls"
        xmlns:converters="clr-namespace:AreaFilter.Converters"
        mc:Ignorable="d"
        Title="Area Filter - Criteria Manager" Height="600" Width="900">
    
    <Window.Resources>
        <converters:RuleToLowSpecVisibilityConverter x:Key="RuleToLowSpecVisibilityConverter"/>
        <converters:RuleToHighSpecVisibilityConverter x:Key="RuleToHighSpecVisibilityConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:HighSpecLabelVisibilityConverter x:Key="HighSpecLabelVisibilityConverter"/>
        
        
        <Style TargetType="ComboBox">
            <Setter Property="Padding" Value="5"/>
            <Setter Property="Height" Value="30"/>
        </Style>
        
        <Style TargetType="controls:NumericUpDown">
            <Setter Property="Height" Value="30"/>
        </Style>
        
        <Style TargetType="Button">
            <Setter Property="Padding" Value="15,5"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        
        <Style TargetType="Label">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Input Section -->
        <GroupBox Grid.Row="0" Header="Add New Criteria" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="120"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Criteria -->
                <Label Grid.Row="0" Grid.Column="0" Content="Criteria:"/>
                <ComboBox Grid.Row="0" Grid.Column="1" 
                          ItemsSource="{Binding CriteriaTypes}"
                          SelectedItem="{Binding SelectedCriteria}"/>
                
                <!-- Rule -->
                <Label Grid.Row="0" Grid.Column="3" Content="Rule:"/>
                <ComboBox Grid.Row="0" Grid.Column="4" 
                          ItemsSource="{Binding RuleTypes}"
                          SelectedItem="{Binding SelectedRule}"/>
                
                <!-- High Spec - Row 2 -->
                <Label Grid.Row="2" Grid.Column="3" Content="High Spec:"
                       Visibility="{Binding IsHighSpecVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <controls:NumericUpDown Grid.Row="2" Grid.Column="4" 
                                        Value="{Binding HighSpec, Mode=TwoWay}"
                                        Visibility="{Binding IsHighSpecVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                
                <!-- Low Spec - Row 4 (or Row 2 if High not visible) -->
                <Label Grid.Column="3" Content="Low Spec:"
                       Visibility="{Binding IsLowSpecVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Label.Style>
                        <Style TargetType="Label" BasedOn="{StaticResource {x:Type Label}}">
                            <Setter Property="Grid.Row" Value="4"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsHighSpecVisible}" Value="False">
                                    <Setter Property="Grid.Row" Value="2"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Label.Style>
                </Label>
                <controls:NumericUpDown Grid.Column="4" 
                                        Value="{Binding LowSpec, Mode=TwoWay}"
                                        Visibility="{Binding IsLowSpecVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <controls:NumericUpDown.Style>
                        <Style TargetType="controls:NumericUpDown" BasedOn="{StaticResource {x:Type controls:NumericUpDown}}">
                            <Setter Property="Grid.Row" Value="4"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsHighSpecVisible}" Value="False">
                                    <Setter Property="Grid.Row" Value="2"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </controls:NumericUpDown.Style>
                </controls:NumericUpDown>
            </Grid>
        </GroupBox>
        
        <!-- Add Button -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="10,5">
            <Button Content="Add New" Command="{Binding AddNewCommand}" Width="100"/>
        </StackPanel>
        
        <!-- DataGrid Section -->
        <GroupBox Grid.Row="2" Header="Criteria List" Padding="10" Margin="0,10,0,0">
            <DataGrid x:Name="CriteriaDataGrid"
                      ItemsSource="{Binding CriteriaItems}"
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      SelectionMode="Single"
                      GridLinesVisibility="All"
                      HeadersVisibility="Column"
                      AllowDrop="True"
                      PreviewMouseLeftButtonDown="DataGrid_PreviewMouseLeftButtonDown"
                      PreviewMouseMove="DataGrid_PreviewMouseMove"
                      Drop="DataGrid_Drop">
                
                
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Order" Binding="{Binding Order}" Width="60" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="HorizontalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="Criteria" Binding="{Binding Criteria}" Width="*" IsReadOnly="True"/>
                    
                    <DataGridTextColumn Header="Rule" Binding="{Binding Rule}" Width="*" IsReadOnly="True"/>
                    
                    <DataGridTextColumn Header="Low Spec" Binding="{Binding LowSpec, StringFormat=F0}" Width="*" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="{Binding Rule, Converter={StaticResource RuleToLowSpecVisibilityConverter}}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    
                    <DataGridTextColumn Header="High Spec" Binding="{Binding HighSpec, StringFormat=F0}" Width="*" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="{Binding Rule, Converter={StaticResource RuleToHighSpecVisibilityConverter}}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
                
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <EventSetter Event="MouseEnter" Handler="DataGridRow_MouseEnter"/>
                        <EventSetter Event="MouseLeave" Handler="DataGridRow_MouseLeave"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridRow">
                                    <Border BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            Background="{TemplateBinding Background}"
                                            SnapsToDevicePixels="True">
                                        <Grid>
                                            <SelectiveScrollingGrid>
                                                <SelectiveScrollingGrid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </SelectiveScrollingGrid.ColumnDefinitions>
                                                <SelectiveScrollingGrid.RowDefinitions>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="Auto"/>
                                                </SelectiveScrollingGrid.RowDefinitions>
                                                
                                                <DataGridCellsPresenter Grid.Column="1"
                                                                        ItemsPanel="{TemplateBinding ItemsPanel}"
                                                                        SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                
                                                <DataGridDetailsPresenter Grid.Column="1"
                                                                         Grid.Row="1"
                                                                         Visibility="{TemplateBinding DetailsVisibility}"
                                                                         SelectiveScrollingGrid.SelectiveScrollingOrientation="{Binding AreRowDetailsFrozen, ConverterParameter={x:Static SelectiveScrollingOrientation.Vertical}, Converter={x:Static DataGrid.RowDetailsScrollingConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                                                
                                                <DataGridRowHeader Grid.RowSpan="2"
                                                                  SelectiveScrollingGrid.SelectiveScrollingOrientation="Vertical"
                                                                  Visibility="{Binding HeadersVisibility, ConverterParameter={x:Static DataGridHeadersVisibility.Row}, Converter={x:Static DataGrid.HeadersVisibilityConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                                            </SelectiveScrollingGrid>
                                            
                                            
                                            <!-- Overlay Delete Button -->
                                            <Button Content="ðŸ—‘" 
                                                    Command="{Binding DataContext.DeleteCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                                    CommandParameter="{Binding}"
                                                    Background="#FFCC0000"
                                                    Foreground="White"
                                                    FontSize="12"
                                                    Padding="5,2"
                                                    Margin="10,0"
                                                    HorizontalAlignment="Right"
                                                    VerticalAlignment="Center"
                                                    Cursor="Hand"
                                                    Visibility="{Binding IsHovered, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                    Panel.ZIndex="1000"
                                                    Click="DeleteButton_Click">
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            BorderBrush="#CC0000"
                                                                            BorderThickness="2"
                                                                            CornerRadius="3"
                                                                            Padding="{TemplateBinding Padding}">
                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Border>
                                                                    <ControlTemplate.Triggers>
                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                            <Setter Property="Background" Value="#FF0000"/>
                                                                        </Trigger>
                                                                    </ControlTemplate.Triggers>
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </Grid>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.RowStyle>
            </DataGrid>
        </GroupBox>
    </Grid>
</Window>
